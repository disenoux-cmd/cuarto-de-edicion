<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED 2.7: Hoja de Lanzamiento - Campa√±a Digital</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (Fixed Version for React compatibility via CDN) -->
    <script src="https://unpkg.com/lucide@0.263.1"></script>

    <!-- HTML2PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        studio: '#1a1d23',
                        console: '#0d0f14',
                        active: '#0066cc',
                        ready: '#00cc88',
                        creative: '#ffcc00',
                        screen: '#f0f2f5',
                        recording: '#ff3333',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar for the dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0d0f14; 
        }
        ::-webkit-scrollbar-thumb {
            background: #374151; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4b5563; 
        }
        
        .preview-phone-frame {
            border: 12px solid #111;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .glass-panel {
            background: rgba(26, 29, 35, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="bg-studio text-gray-300 font-sans h-screen overflow-hidden selection:bg-active selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons handled by Lucide component wrapper
        // Updated to be more robust with the pinned version
        const Icon = ({ name, size = 20, className = "" }) => {
            if (!window.lucide || !window.lucide.icons) return null;
            
            const lucideIcon = window.lucide.icons[name];
            if (!lucideIcon) {
                console.warn(`Icon ${name} not found`);
                return null;
            }
            
            // Safe check for toSvg method
            if (typeof lucideIcon.toSvg !== 'function') {
                return <span className="text-xs text-red-500">Icon Error</span>;
            }

            const svgString = lucideIcon.toSvg({
                width: size,
                height: size,
                class: className
            });

            // Extract inner contents to inject into our React SVG wrapper for better control
            // or just inject the whole string if needed. Here we keep the pattern but ensure it matches.
            const match = svgString.match(/<svg[^>]*>([\s\S]*?)<\/svg>/);
            const innerContent = match ? match[1] : '';

            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                    dangerouslySetInnerHTML={{ __html: innerContent }}
                />
            );
        };

        // --- MOCK DATA & HELPERS ---

        const predefinedHashtags = {
            'Ciencia Ficci√≥n': ['#SciFiArt', '#FuturoIA', '#CyberpunkStyle', '#DigitalStory'],
            'Suspenso': ['#Misterio', '#ThrillerDigital', '#SuspensoIA', '#DarkAesthetic'],
            'Aventura': ['#AventuraEpica', '#ViajeDigital', '#Exploracion', '#FantasyArt'],
            'General': ['#ArteDigital', '#IAcreativa', '#EstudianteDigital', '#ProyectoEscolar']
        };

        const motivationalMessages = {
            25: "¬°Vamos bien! Tu idea toma forma üöÄ",
            50: "¬°Excelente! La campa√±a se ve s√≥lida üí™",
            75: "¬°Casi listo! Revisa los detalles finales ‚ú®",
            100: "üöÄ ¬°Tu campa√±a est√° lista para despegar! üåï"
        };

        // --- COMPONENTS ---

        const ProgressBar = ({ progress }) => (
            <div className="w-full bg-console h-3 rounded-full overflow-hidden border border-gray-700 relative group">
                <div 
                    className="h-full bg-gradient-to-r from-active to-purple-500 transition-all duration-500 relative"
                    style={{ width: `${progress}%` }}
                >
                    <div className="absolute inset-0 bg-white opacity-20 animate-pulse"></div>
                </div>
                <div className="absolute top-0 right-0 h-full flex items-center pr-2 text-[10px] text-white font-mono opacity-0 group-hover:opacity-100 transition-opacity">
                    {Math.round(progress)}%
                </div>
            </div>
        );

        const Achievement = ({ title, icon, color, unlocked }) => (
            <div className={`flex flex-col items-center p-2 rounded-lg transition-all duration-300 ${unlocked ? 'bg-gray-800 scale-100 opacity-100' : 'bg-transparent scale-90 opacity-30 grayscale'}`}>
                <div className={`p-2 rounded-full mb-1 ${color} bg-opacity-20`}>
                    <Icon name={icon} className={color.replace('bg-', 'text-')} />
                </div>
                <span className="text-[10px] font-bold text-center uppercase tracking-wider">{title}</span>
            </div>
        );

        const FileInput = ({ onImageSelect }) => {
            const fileInputRef = useRef(null);
            
            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        onImageSelect(reader.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div 
                    className="border-2 border-dashed border-gray-600 rounded-xl p-8 text-center hover:border-active hover:bg-active hover:bg-opacity-5 transition-all cursor-pointer group"
                    onClick={() => fileInputRef.current.click()}
                >
                    <input 
                        type="file" 
                        ref={fileInputRef} 
                        onChange={handleFileChange} 
                        accept="image/*" 
                        className="hidden" 
                    />
                    <Icon name="UploadCloud" size={40} className="mx-auto text-gray-500 group-hover:text-active mb-3" />
                    <p className="text-sm text-gray-400 group-hover:text-white">Arrastra o haz clic para subir tu imagen IA</p>
                    <span className="text-xs text-gray-600 mt-2 block">JPG, PNG, WebP (Max 5MB)</span>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        const App = () => {
            // State
            const [activeTab, setActiveTab] = useState('header');
            const [progress, setProgress] = useState(0);
            const [data, setData] = useState({
                studentName: '',
                date: new Date().toLocaleDateString(),
                storyTitle: '',
                storyGenre: 'Ciencia Ficci√≥n',
                storyText: '',
                imageSrc: null,
                aiTool: 'Midjourney',
                prompt: '',
                targetAudience: '12-15 a√±os',
                copyText: '',
                hashtags: [],
                ethics: {
                    original: false,
                    safe: false,
                    ready: false
                },
                rubricScore: 8 // Default self-eval
            });
            const [showConfetti, setShowConfetti] = useState(false);
            const [toast, setToast] = useState(null);
            const [exporting, setExporting] = useState(false);

            // Achievements State
            const achievements = {
                historian: data.storyText.length > 50,
                artist: !!data.imageSrc,
                strategist: data.hashtags.length >= 3,
                citizen: Object.values(data.ethics).every(Boolean)
            };

            // Effects
            useEffect(() => {
                calculateProgress();
            }, [data]);

            useEffect(() => {
                if (toast) {
                    const timer = setTimeout(() => setToast(null), 3000);
                    return () => clearTimeout(timer);
                }
            }, [toast]);

            const calculateProgress = () => {
                let points = 0;
                let total = 7; // Name, Title, Story, Image, Prompt, Copy, Ethics

                if (data.studentName) points++;
                if (data.storyTitle) points += 0.5;
                if (data.storyText.length > 20) points += 1; // Weighted more
                if (data.imageSrc) points += 1.5; // Weighted more
                if (data.prompt) points++;
                if (data.copyText) points++;
                if (Object.values(data.ethics).every(Boolean)) points++;

                const percent = Math.min(100, Math.round((points / total) * 100));
                
                // Check milestones for toast
                if (percent >= 25 && progress < 25) showToast(motivationalMessages[25], 'info');
                if (percent >= 50 && progress < 50) showToast(motivationalMessages[50], 'success');
                if (percent >= 75 && progress < 75) showToast(motivationalMessages[75], 'warning');
                if (percent === 100 && progress < 100) {
                    showToast(motivationalMessages[100], 'success');
                    triggerConfetti();
                }

                setProgress(percent);
            };

            const triggerConfetti = () => {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            };

            const showToast = (message, type = 'info') => {
                setToast({ message, type });
            };

            // Handlers
            const handleInputChange = (field, value) => {
                setData(prev => ({ ...prev, [field]: value }));
            };

            const handleNestedChange = (parent, field, value) => {
                setData(prev => ({
                    ...prev,
                    [parent]: { ...prev[parent], [field]: value }
                }));
            };

            const importFromPreviousRED = () => {
                // Simulating fetching from LocalStorage/Previous RED
                setData(prev => ({
                    ...prev,
                    storyTitle: "El Despertar de los Circuitos",
                    storyText: "En un a√±o 3042 donde las m√°quinas so√±aban, K-9 descubri√≥ que ten√≠a emociones. Todo comenz√≥ cuando encontr√≥ una vieja flor preservada en √°mbar...",
                    storyGenre: "Ciencia Ficci√≥n",
                    hashtags: ["#RobotFeeling", "#SciFi", "#HistoriaDigital"],
                    targetAudience: "15-18 a√±os"
                }));
                showToast("¬°Datos importados del Laboratorio de Historias!", "success");
            };

            const analyzePrompt = () => {
                if (data.prompt.length < 10) {
                    showToast("El prompt es muy corto. Intenta a√±adir detalles.", "error");
                } else {
                    const adjectives = (data.prompt.match(/\b(brillante|oscuro|futurista|antiguo|grande|peque√±o|azul|rojo)\b/gi) || []).length;
                    if (adjectives > 0) {
                        showToast(`¬°Buen trabajo! Detect√© ${adjectives} descriptores visuales.`, "success");
                    } else {
                        showToast("Intenta usar m√°s adjetivos descriptivos.", "warning");
                    }
                }
            };

            const generateCopy = () => {
                const copies = [
                    `üöÄ ¬°Nueva historia disponible! "${data.storyTitle || 'Mi Historia'}" ya est√° aqu√≠. Creada con IA y mucha imaginaci√≥n. ¬øQu√© opinan? üëá`,
                    `‚ú® Sum√©rgete en "${data.storyTitle || 'un nuevo mundo'}". Una experiencia visual y narrativa √∫nica. #ArteDigital`,
                    `üî• ¬øTe imaginas un mundo as√≠? Mira mi √∫ltima creaci√≥n: "${data.storyTitle || 'Proyecto'}". Hecho para la clase de Navegando con Inteligencia.`
                ];
                handleInputChange('copyText', copies[Math.floor(Math.random() * copies.length)]);
            };

            const toggleHashtag = (tag) => {
                const current = [...data.hashtags];
                if (current.includes(tag)) {
                    handleInputChange('hashtags', current.filter(t => t !== tag));
                } else {
                    if (current.length < 5) {
                        handleInputChange('hashtags', [...current, tag]);
                    } else {
                        showToast("M√°ximo 5 hashtags permitidos", "warning");
                    }
                }
            };

            // --- EXPORT FUNCTIONALITY ---
            const exportPDF = () => {
                setExporting(true);
                const element = document.getElementById('export-content');
                
                // Make visible temporarily for capture
                element.style.display = 'block';

                const opt = {
                    margin:       0.5,
                    filename:     `Campa√±a_${data.studentName || 'Estudiante'}.pdf`,
                    image:        { type: 'jpeg', quality: 0.98 },
                    html2canvas:  { scale: 2, useCORS: true },
                    jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
                };

                html2pdf().set(opt).from(element).save().then(() => {
                    element.style.display = 'none';
                    setExporting(false);
                    showToast("¬°PDF Generado y Descargado!", "success");
                });
            };

            // --- RENDER HELPERS ---
            
            const renderActivePanel = () => {
                switch(activeTab) {
                    case 'header':
                        return (
                            <div className="space-y-6 animate-fade-in">
                                <div className="bg-console p-6 rounded-xl border border-gray-800">
                                    <h2 className="text-xl font-bold text-white mb-4 flex items-center">
                                        <Icon name="UserCircle" className="mr-2 text-active" /> 
                                        Identificaci√≥n del Director Creativo
                                    </h2>
                                    <div className="grid gap-4">
                                        <div>
                                            <label className="block text-sm text-gray-400 mb-1">Nombre Completo</label>
                                            <input 
                                                type="text" 
                                                value={data.studentName}
                                                onChange={(e) => handleInputChange('studentName', e.target.value)}
                                                className="w-full bg-studio border border-gray-700 rounded p-3 text-white focus:border-active focus:outline-none transition-colors"
                                                placeholder="Ej. Ana P√©rez"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm text-gray-400 mb-1">Fecha de Producci√≥n</label>
                                            <input 
                                                type="text" 
                                                disabled
                                                value={data.date}
                                                className="w-full bg-studio border border-gray-800 rounded p-3 text-gray-500 cursor-not-allowed"
                                            />
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-gradient-to-r from-active to-purple-900 p-6 rounded-xl text-white">
                                    <h3 className="font-bold text-lg mb-2">üëã ¬°Bienvenido al Cuarto de Edici√≥n!</h3>
                                    <p className="text-sm opacity-90">Aqu√≠ consolidar√°s todo tu trabajo del m√≥dulo. Sigue los pasos en el men√∫ izquierdo para construir tu campa√±a profesional. ¬°Tu progreso se guarda autom√°ticamente!</p>
                                </div>
                            </div>
                        );
                    case 'story':
                        return (
                            <div className="space-y-6 animate-fade-in">
                                <div className="flex justify-between items-center mb-2">
                                    <h2 className="text-xl font-bold text-white">La Materia Prima (Historia)</h2>
                                    <button 
                                        onClick={importFromPreviousRED}
                                        className="text-xs bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded flex items-center transition-colors"
                                    >
                                        <Icon name="Import" size={14} className="mr-1" /> Importar RED 2.3
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm text-gray-400 mb-1">T√≠tulo de la Historia</label>
                                        <input 
                                            type="text" 
                                            value={data.storyTitle}
                                            onChange={(e) => handleInputChange('storyTitle', e.target.value)}
                                            className="w-full bg-console border border-gray-700 rounded p-3 text-white focus:border-active focus:outline-none"
                                            placeholder="El t√≠tulo impactante..."
                                        />
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm text-gray-400 mb-1">G√©nero</label>
                                            <select 
                                                value={data.storyGenre}
                                                onChange={(e) => handleInputChange('storyGenre', e.target.value)}
                                                className="w-full bg-console border border-gray-700 rounded p-3 text-white focus:border-active focus:outline-none"
                                            >
                                                <option>Ciencia Ficci√≥n</option>
                                                <option>Suspenso</option>
                                                <option>Aventura</option>
                                                <option>Romance</option>
                                                <option>Fantas√≠a</option>
                                            </select>
                                        </div>
                                        <div className="flex items-center justify-center">
                                           <div className={`px-4 py-2 rounded-full text-xs font-bold ${
                                               data.storyGenre === 'Ciencia Ficci√≥n' ? 'bg-blue-900 text-blue-200' :
                                               data.storyGenre === 'Suspenso' ? 'bg-purple-900 text-purple-200' :
                                               data.storyGenre === 'Aventura' ? 'bg-green-900 text-green-200' : 'bg-gray-700'
                                           }`}>
                                               Estilo Visual: {data.storyGenre}
                                           </div>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm text-gray-400 mb-1">Sinopsis / Historia Corta</label>
                                        <textarea 
                                            value={data.storyText}
                                            onChange={(e) => handleInputChange('storyText', e.target.value)}
                                            className="w-full bg-console border border-gray-700 rounded p-3 text-white h-40 focus:border-active focus:outline-none font-mono text-sm leading-relaxed"
                                            placeholder="Escribe aqu√≠ tu historia..."
                                        />
                                        <div className="text-right text-xs text-gray-500 mt-1">
                                            {data.storyText.length} caracteres
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'visuals':
                        return (
                            <div className="space-y-6 animate-fade-in">
                                <h2 className="text-xl font-bold text-white mb-4">El Arte Visual (IA)</h2>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Upload Area */}
                                    <div>
                                        <label className="block text-sm text-gray-400 mb-2">Imagen Generada</label>
                                        {data.imageSrc ? (
                                            <div className="relative group">
                                                <img src={data.imageSrc} alt="Uploaded" className="w-full rounded-lg border-2 border-gray-700 shadow-lg" />
                                                <button 
                                                    onClick={() => handleInputChange('imageSrc', null)}
                                                    className="absolute top-2 right-2 bg-red-600 p-2 rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity"
                                                >
                                                    <Icon name="Trash2" size={16} />
                                                </button>
                                            </div>
                                        ) : (
                                            <FileInput onImageSelect={(src) => handleInputChange('imageSrc', src)} />
                                        )}
                                    </div>

                                    {/* Metadata Area */}
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm text-gray-400 mb-1">Herramienta IA Usada</label>
                                            <select 
                                                value={data.aiTool}
                                                onChange={(e) => handleInputChange('aiTool', e.target.value)}
                                                className="w-full bg-console border border-gray-700 rounded p-3 text-white focus:border-active focus:outline-none"
                                            >
                                                <option>Midjourney</option>
                                                <option>DALL-E 3</option>
                                                <option>Stable Diffusion</option>
                                                <option>Bing Image Creator</option>
                                                <option>Canva Magic Media</option>
                                                <option>Adobe Firefly</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm text-gray-400 mb-1">Prompt Utilizado</label>
                                            <textarea 
                                                value={data.prompt}
                                                onChange={(e) => handleInputChange('prompt', e.target.value)}
                                                className="w-full bg-console border border-gray-700 rounded p-3 text-white h-32 focus:border-active focus:outline-none text-sm"
                                                placeholder="/imagine prompt: ..."
                                            />
                                            <button 
                                                onClick={analyzePrompt}
                                                className="mt-2 text-xs bg-active bg-opacity-20 text-active hover:bg-opacity-30 px-3 py-1 rounded flex items-center transition-colors w-full justify-center"
                                            >
                                                <Icon name="Wand2" size={14} className="mr-1" /> Analizar Prompt
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'strategy':
                        return (
                            <div className="space-y-6 animate-fade-in">
                                <div className="flex justify-between items-center mb-2">
                                    <h2 className="text-xl font-bold text-white">Estrategia de Difusi√≥n</h2>
                                    <button 
                                        onClick={() => showToast("Datos simulados cargados del RED 2.6", "info")}
                                        className="text-xs bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded flex items-center transition-colors"
                                    >
                                        <Icon name="Map" size={14} className="mr-1" /> Importar RED 2.6
                                    </button>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm text-gray-400 mb-1">Audiencia Objetivo</label>
                                        <select 
                                            value={data.targetAudience}
                                            onChange={(e) => handleInputChange('targetAudience', e.target.value)}
                                            className="w-full bg-console border border-gray-700 rounded p-3 text-white"
                                        >
                                            <option>12-15 a√±os (Estudiantes)</option>
                                            <option>15-18 a√±os (J√≥venes)</option>
                                            <option>Padres y Familia</option>
                                            <option>Comunidad Educativa General</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm text-gray-400 mb-1">Red Social Principal</label>
                                        <div className="flex space-x-2">
                                            <div className="bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-500 w-8 h-8 rounded-lg flex items-center justify-center">
                                                <Icon name="Instagram" size={16} className="text-white" />
                                            </div>
                                            <div className="bg-black w-8 h-8 rounded-lg flex items-center justify-center border border-gray-700">
                                                <span className="text-white font-bold text-xs">Tk</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div className="flex justify-between items-end mb-1">
                                        <label className="block text-sm text-gray-400">Copy (Texto de la publicaci√≥n)</label>
                                        <button onClick={generateCopy} className="text-xs text-creative hover:underline flex items-center">
                                            <Icon name="Sparkles" size={12} className="mr-1" /> Generar Idea
                                        </button>
                                    </div>
                                    <textarea 
                                        value={data.copyText}
                                        onChange={(e) => handleInputChange('copyText', e.target.value)}
                                        className="w-full bg-console border border-gray-700 rounded p-3 text-white h-24 focus:border-active focus:outline-none"
                                        placeholder="Escribe un mensaje pegadizo..."
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm text-gray-400 mb-2">Hashtags Sugeridos (Max 5)</label>
                                    <div className="flex flex-wrap gap-2">
                                        {(predefinedHashtags[data.storyGenre] || predefinedHashtags['General']).map(tag => (
                                            <button
                                                key={tag}
                                                onClick={() => toggleHashtag(tag)}
                                                className={`px-3 py-1 rounded-full text-xs transition-colors border ${
                                                    data.hashtags.includes(tag) 
                                                        ? 'bg-active border-active text-white' 
                                                        : 'bg-transparent border-gray-600 text-gray-400 hover:border-gray-400'
                                                }`}
                                            >
                                                {tag}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="mt-2 text-xs text-gray-500">
                                        Seleccionados: {data.hashtags.join(' ')}
                                    </div>
                                </div>
                            </div>
                        );
                    case 'ethics':
                        return (
                            <div className="space-y-6 animate-fade-in">
                                <h2 className="text-xl font-bold text-white mb-4">Reflexi√≥n √âtica y Cierre</h2>
                                
                                <div className="bg-console p-6 rounded-xl border border-gray-800 space-y-4">
                                    <div className="flex items-start space-x-3 p-3 hover:bg-gray-800 rounded-lg transition-colors cursor-pointer"
                                         onClick={() => handleNestedChange('ethics', 'original', !data.ethics.original)}>
                                        <div className={`w-6 h-6 rounded border-2 flex items-center justify-center mt-1 ${data.ethics.original ? 'bg-ready border-ready' : 'border-gray-500'}`}>
                                            {data.ethics.original && <Icon name="Check" size={14} className="text-black" />}
                                        </div>
                                        <div>
                                            <h4 className="font-bold text-gray-200">Originalidad y Respeto</h4>
                                            <p className="text-xs text-gray-500">He creado una historia original o he dado cr√©dito a mis inspiraciones.</p>
                                        </div>
                                    </div>

                                    <div className="flex items-start space-x-3 p-3 hover:bg-gray-800 rounded-lg transition-colors cursor-pointer"
                                         onClick={() => handleNestedChange('ethics', 'safe', !data.ethics.safe)}>
                                        <div className={`w-6 h-6 rounded border-2 flex items-center justify-center mt-1 ${data.ethics.safe ? 'bg-ready border-ready' : 'border-gray-500'}`}>
                                            {data.ethics.safe && <Icon name="Check" size={14} className="text-black" />}
                                        </div>
                                        <div>
                                            <h4 className="font-bold text-gray-200">Seguridad Digital</h4>
                                            <p className="text-xs text-gray-500">Mi imagen y texto no son ofensivos y son seguros para compartir.</p>
                                        </div>
                                    </div>

                                    <div className="flex items-start space-x-3 p-3 hover:bg-gray-800 rounded-lg transition-colors cursor-pointer"
                                         onClick={() => handleNestedChange('ethics', 'ready', !data.ethics.ready)}>
                                        <div className={`w-6 h-6 rounded border-2 flex items-center justify-center mt-1 ${data.ethics.ready ? 'bg-ready border-ready' : 'border-gray-500'}`}>
                                            {data.ethics.ready && <Icon name="Check" size={14} className="text-black" />}
                                        </div>
                                        <div>
                                            <h4 className="font-bold text-gray-200">Revisi√≥n Final</h4>
                                            <p className="text-xs text-gray-500">He revisado la ortograf√≠a y la calidad de la imagen.</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="pt-4 border-t border-gray-800">
                                    <label className="block text-sm text-gray-400 mb-2">Autoevaluaci√≥n (1-10)</label>
                                    <input 
                                        type="range" 
                                        min="1" 
                                        max="10" 
                                        value={data.rubricScore}
                                        onChange={(e) => handleInputChange('rubricScore', e.target.value)}
                                        className="w-full accent-active cursor-pointer"
                                    />
                                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>Necesita Mejorar</span>
                                        <span className="text-white font-bold">{data.rubricScore} Puntos</span>
                                        <span>Excelente</span>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'export':
                        return (
                            <div className="space-y-6 animate-fade-in text-center pt-10">
                                {progress < 100 ? (
                                    <div className="text-yellow-500">
                                        <Icon name="AlertTriangle" size={48} className="mx-auto mb-4" />
                                        <h2 className="text-xl font-bold mb-2">Campa√±a Incompleta</h2>
                                        <p className="text-gray-400">Por favor completa todas las secciones antes de exportar.</p>
                                        <p className="text-sm mt-4 text-gray-500">Progreso actual: {progress}%</p>
                                    </div>
                                ) : (
                                    <>
                                        <Icon name="CheckCircle" size={60} className="mx-auto text-ready mb-4" />
                                        <h2 className="text-2xl font-bold text-white mb-2">¬°Todo listo para el lanzamiento!</h2>
                                        <p className="text-gray-400 mb-8 max-w-md mx-auto">Has completado todos los pasos. Puedes descargar tu paquete profesional ahora.</p>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto">
                                            <button 
                                                onClick={exportPDF}
                                                disabled={exporting}
                                                className="bg-active hover:bg-blue-600 text-white p-4 rounded-xl flex items-center justify-center space-x-2 transition-transform transform hover:scale-105"
                                            >
                                                {exporting ? <Icon name="Loader2" className="animate-spin" /> : <Icon name="FileText" />}
                                                <span>Descargar PDF Oficial</span>
                                            </button>
                                            
                                            <button 
                                                onClick={() => showToast("Simulaci√≥n: Enviado a Moodle exitosamente", "success")}
                                                className="bg-orange-600 hover:bg-orange-700 text-white p-4 rounded-xl flex items-center justify-center space-x-2 transition-transform transform hover:scale-105"
                                            >
                                                <Icon name="Upload" />
                                                <span>Subir a Moodle</span>
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        );
                    default:
                        return null;
                }
            };

            return (
                <div className="flex h-screen bg-studio">
                    {/* --- LEFT SIDEBAR (Navigation) --- */}
                    <div className="w-20 md:w-64 bg-console border-r border-gray-800 flex flex-col justify-between p-4">
                        <div>
                            <div className="flex items-center space-x-2 mb-8 px-2">
                                <div className="bg-active p-2 rounded-lg">
                                    <Icon name="Clapperboard" className="text-white" size={24} />
                                </div>
                                <span className="font-bold text-white hidden md:block tracking-tight">RED 2.7<br/><span className="text-xs text-gray-500 font-normal">Cuarto de Edici√≥n</span></span>
                            </div>

                            <nav className="space-y-2">
                                {[
                                    { id: 'header', icon: 'UserCircle', label: 'Inicio' },
                                    { id: 'story', icon: 'BookOpen', label: 'Historia' },
                                    { id: 'visuals', icon: 'Image', label: 'Arte Visual' },
                                    { id: 'strategy', icon: 'Share2', label: 'Estrategia' },
                                    { id: 'ethics', icon: 'ShieldCheck', label: '√âtica' },
                                    { id: 'export', icon: 'Download', label: 'Exportar' },
                                ].map((item) => (
                                    <button
                                        key={item.id}
                                        onClick={() => setActiveTab(item.id)}
                                        className={`w-full flex items-center space-x-3 px-3 py-3 rounded-lg transition-all ${
                                            activeTab === item.id 
                                                ? 'bg-gray-800 text-active border-l-4 border-active' 
                                                : 'text-gray-400 hover:bg-gray-900 hover:text-gray-200'
                                        }`}
                                    >
                                        <Icon name={item.icon} size={20} />
                                        <span className="hidden md:block text-sm font-medium">{item.label}</span>
                                    </button>
                                ))}
                            </nav>
                        </div>

                        <div className="bg-gray-900 rounded-xl p-4 hidden md:block">
                            <h4 className="text-xs font-bold text-gray-500 uppercase mb-3">Logros</h4>
                            <div className="grid grid-cols-4 gap-2">
                                <Achievement title="Hist" icon="Feather" color="bg-blue-500" unlocked={achievements.historian} />
                                <Achievement title="Art" icon="Palette" color="bg-purple-500" unlocked={achievements.artist} />
                                <Achievement title="Strat" icon="TrendingUp" color="bg-green-500" unlocked={achievements.strategist} />
                                <Achievement title="Ethic" icon="Heart" color="bg-red-500" unlocked={achievements.citizen} />
                            </div>
                        </div>
                    </div>

                    {/* --- MAIN EDITOR --- */}
                    <div className="flex-1 flex flex-col min-w-0">
                        {/* Top Bar */}
                        <div className="h-16 bg-studio border-b border-gray-800 flex items-center justify-between px-8">
                            <div className="w-1/3">
                                <h1 className="font-bold text-white">
                                    {activeTab === 'header' ? 'Identificaci√≥n' : 
                                     activeTab === 'story' ? 'Guion Narrativo' :
                                     activeTab === 'visuals' ? 'Estudio Gr√°fico' :
                                     activeTab === 'strategy' ? 'Sala de Estrategia' :
                                     activeTab === 'ethics' ? 'Control de Calidad' : 'Entrega Final'}
                                </h1>
                            </div>
                            <div className="w-1/3 flex flex-col items-center">
                                <span className="text-xs text-gray-400 mb-1">Progreso General</span>
                                <ProgressBar progress={progress} />
                            </div>
                            <div className="w-1/3 flex justify-end items-center space-x-4">
                                <button className="text-gray-400 hover:text-white" title="Ayuda">
                                    <Icon name="HelpCircle" size={20} />
                                </button>
                                <div className="w-8 h-8 rounded-full bg-gradient-to-br from-active to-purple-600 flex items-center justify-center text-xs font-bold text-white border border-white border-opacity-20">
                                    {data.studentName ? data.studentName.charAt(0).toUpperCase() : '?'}
                                </div>
                            </div>
                        </div>

                        {/* Content Area */}
                        <div className="flex-1 p-8 overflow-y-auto relative">
                            {renderActivePanel()}
                        </div>
                    </div>

                    {/* --- RIGHT SIDEBAR (Preview) --- */}
                    <div className="w-80 md:w-96 bg-gray-900 border-l border-black p-6 flex flex-col items-center justify-center hidden lg:flex">
                        <h3 className="text-gray-500 text-xs font-bold uppercase mb-4 tracking-widest">Previsualizaci√≥n Real-Time</h3>
                        
                        {/* Phone Mockup */}
                        <div className="preview-phone-frame w-64 h-[550px] bg-white relative">
                            {/* Status Bar Mock */}
                            <div className="h-6 bg-white flex justify-between items-center px-4 text-[10px] font-bold text-black border-b border-gray-100">
                                <span>9:41</span>
                                <div className="flex space-x-1">
                                    <Icon name="Signal" size={10} className="text-black" />
                                    <Icon name="Wifi" size={10} className="text-black" />
                                    <Icon name="Battery" size={10} className="text-black" />
                                </div>
                            </div>

                            {/* App Header */}
                            <div className="h-12 bg-white flex items-center justify-between px-3 border-b border-gray-100">
                                <div className="font-bold text-sm">Instagram</div>
                                <Icon name="MoreHorizontal" size={16} className="text-black" />
                            </div>

                            {/* Post Content */}
                            <div className="overflow-hidden bg-white h-full pb-20 overflow-y-auto">
                                {/* User Info */}
                                <div className="flex items-center p-2">
                                    <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-yellow-400 to-red-500 mr-2"></div>
                                    <div className="text-xs font-bold text-black">{data.studentName ? data.studentName.toLowerCase().replace(/ /g, '_') : 'usuario_creativo'}</div>
                                </div>

                                {/* Image */}
                                <div className="w-full aspect-square bg-gray-200 flex items-center justify-center overflow-hidden">
                                    {data.imageSrc ? (
                                        <img src={data.imageSrc} className="w-full h-full object-cover" />
                                    ) : (
                                        <div className="text-gray-400 flex flex-col items-center">
                                            <Icon name="Image" size={32} className="mb-2" />
                                            <span className="text-[10px]">Sin imagen</span>
                                        </div>
                                    )}
                                </div>

                                {/* Action Buttons */}
                                <div className="flex space-x-3 p-2">
                                    <Icon name="Heart" size={20} className="text-black" />
                                    <Icon name="MessageCircle" size={20} className="text-black" />
                                    <Icon name="Send" size={20} className="text-black" />
                                </div>

                                {/* Caption Area */}
                                <div className="px-3 pb-4">
                                    <div className="text-xs font-bold text-black mb-1">1,240 Me gusta</div>
                                    <div className="text-xs text-black">
                                        <span className="font-bold mr-1">{data.studentName ? data.studentName.toLowerCase().replace(/ /g, '_') : 'usuario'}:</span>
                                        {data.copyText || 'Aqu√≠ aparecer√° tu copy creativo...'}
                                    </div>
                                    <div className="mt-2 text-active text-xs">
                                        {data.hashtags.map(t => <span key={t} className="mr-1">{t}</span>)}
                                    </div>
                                    <div className="mt-2 text-[10px] text-gray-400 uppercase">HACE 2 MINUTOS</div>
                                </div>
                            </div>
                        </div>

                        <div className="mt-6 text-center">
                            <p className="text-xs text-gray-600">Simulaci√≥n de Post en Red Social</p>
                            <div className="flex justify-center mt-2 space-x-2">
                                <div className="w-2 h-2 rounded-full bg-active"></div>
                                <div className="w-2 h-2 rounded-full bg-gray-700"></div>
                            </div>
                        </div>
                    </div>

                    {/* --- TOAST NOTIFICATION --- */}
                    {toast && (
                        <div className={`fixed bottom-8 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-2xl flex items-center space-x-3 z-50 animate-bounce ${
                            toast.type === 'success' ? 'bg-ready text-black' : 
                            toast.type === 'error' ? 'bg-red-500 text-white' : 
                            toast.type === 'warning' ? 'bg-creative text-black' : 'bg-active text-white'
                        }`}>
                            <Icon name={toast.type === 'success' ? 'Check' : toast.type === 'error' ? 'AlertOctagon' : 'Info'} size={18} />
                            <span className="font-bold text-sm">{toast.message}</span>
                        </div>
                    )}
                    
                    {/* --- HIDDEN PDF TEMPLATE --- */}
                    <div id="export-content" style={{ display: 'none' }} className="bg-white text-black p-10 max-w-[800px]">
                        <div className="border-b-2 border-black pb-4 mb-6 flex justify-between items-end">
                            <div>
                                <h1 className="text-3xl font-bold uppercase tracking-widest">Hoja de Lanzamiento</h1>
                                <p className="text-sm text-gray-600">Campa√±a Digital - RED 2.7</p>
                            </div>
                            <div className="text-right">
                                <p className="font-bold">{data.studentName}</p>
                                <p className="text-xs">{data.date}</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-6 mb-8">
                            <div className="col-span-2 space-y-4">
                                <div className="bg-gray-100 p-4 rounded">
                                    <h3 className="font-bold border-b border-gray-300 mb-2 text-sm uppercase">Ficha T√©cnica</h3>
                                    <div className="grid grid-cols-2 text-sm gap-2">
                                        <p><span className="font-bold">T√≠tulo:</span> {data.storyTitle}</p>
                                        <p><span className="font-bold">G√©nero:</span> {data.storyGenre}</p>
                                        <p><span className="font-bold">Audiencia:</span> {data.targetAudience}</p>
                                        <p><span className="font-bold">IA Visual:</span> {data.aiTool}</p>
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 className="font-bold text-lg mb-2">Narrativa</h3>
                                    <p className="text-sm italic text-gray-700 border-l-4 border-black pl-4">
                                        "{data.storyText}"
                                    </p>
                                </div>

                                <div>
                                    <h3 className="font-bold text-lg mb-2">Estrategia de Copy</h3>
                                    <p className="text-sm bg-gray-50 p-3 rounded border border-gray-200 font-mono">
                                        {data.copyText}
                                    </p>
                                    <p className="text-blue-600 text-sm mt-1 font-bold">
                                        {data.hashtags.join(' ')}
                                    </p>
                                </div>
                            </div>

                            <div className="col-span-1">
                                <div className="border-4 border-black p-2 bg-white shadow-lg rotate-1 transform">
                                    <div className="aspect-square bg-gray-200 overflow-hidden mb-2">
                                        {data.imageSrc && <img src={data.imageSrc} className="w-full h-full object-cover" />}
                                    </div>
                                    <p className="text-center font-mono text-xs truncate">{data.prompt || 'Sin prompt'}</p>
                                </div>
                                <div className="mt-6">
                                    <h3 className="font-bold text-sm uppercase mb-2">Validaci√≥n √âtica</h3>
                                    <ul className="text-xs space-y-1">
                                        <li className="flex items-center">
                                            <span className={`w-3 h-3 rounded-full mr-2 ${data.ethics.original ? 'bg-green-500' : 'bg-gray-300'}`}></span>
                                            Originalidad
                                        </li>
                                        <li className="flex items-center">
                                            <span className={`w-3 h-3 rounded-full mr-2 ${data.ethics.safe ? 'bg-green-500' : 'bg-gray-300'}`}></span>
                                            Seguridad
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div className="border-t-2 border-black pt-4 text-center">
                            <p className="text-xs text-gray-500">Documento generado con RED 2.7 "Cuarto de Edici√≥n" | Navegando con Inteligencia</p>
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>